<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Kasir POS</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-blue': '#1c0cdc',
                        'accent-coffee': '#6f4e37',
                        'soft-gray': '#f8fafc'
                    },
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif'],
                    },
                    boxShadow: {
                        'custom': '0 10px 15px -3px rgba(0, 0, 0, 0.08), 0 4px 6px -2px rgba(0, 0, 0, 0.05)',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
        .container-main {
            display: flex;
            min-height: 100vh;
        }
        .sidebar {
            width: 280px;
            background-color: #1c0cdc;
            color: #ffffff;
            transition: transform 0.3s ease-in-out;
            transform: translateX(0);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .sidebar-hidden {
            transform: translateX(-100%);
            position: absolute;
            z-index: 50;
        }
        .content-area {
            flex-grow: 1;
            padding: 1.5rem;
            background-color: #f8fafc;
            transition: margin-left 0.3s ease-in-out;
        }
        .menu-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            cursor: pointer;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            transition: background-color 0.2s ease-in-out;
        }
        .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        .menu-item.active {
            background-color: rgba(255, 255, 255, 0.2);
            font-weight: 600;
        }
        .card {
            background-color: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .mobile-header {
            display: none;
        }
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                top: 0;
                left: 0;
                height: 100%;
                z-index: 50;
            }
            .content-area {
                padding: 1rem;
            }
            .mobile-header {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 1rem;
                background-color: #ffffff;
                border-bottom: 1px solid #e5e7eb;
            }
            .sidebar-show-mobile {
                transform: translateX(0);
            }
            .overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.5);
                z-index: 40;
            }
        }
    </style>
</head>
<body class="bg-soft-gray font-inter text-gray-800">

    <div id="overlay" class="overlay hidden md:hidden"></div>

    <!-- Mobile Header -->
    <div id="mobile-header" class="mobile-header fixed top-0 left-0 right-0 z-40">
        <button id="sidebar-toggle-mobile" class="p-2 rounded-lg text-primary-blue focus:outline-none">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
        </button>
        <h1 id="page-title" class="text-xl font-bold">Dashboard</h1>
    </div>

    <div class="container-main">
        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar bg-primary-blue text-white shadow-lg fixed md:relative md:flex flex-col z-50">
            <div class="p-6">
                <h1 class="text-2xl font-bold text-white">Kopi<span class="text-accent-coffee">Aku</span></h1>
            </div>
            <nav class="p-4 flex-grow">
                <ul>
                    <li>
                        <a href="#" class="menu-item active" data-page="dashboard">
                            <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-10l2-2m-2 2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="menu-item" data-page="kasir">
                            <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                            <span>Kasir</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="menu-item" data-page="stok">
                            <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
                            <span>Manajemen Stok</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="menu-item" data-page="karyawan">
                            <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                            <span>Shift Karyawan</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="menu-item" data-page="qris-gopay">
                            <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7"></path></svg>
                            <span>QRIS & GoPay</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="content-area mt-16 md:mt-0">
            <!-- Halaman Dashboard -->
            <div id="page-dashboard" class="page-content">
                <h2 class="text-3xl font-bold mb-6 text-gray-900">Dashboard</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                    <div class="card p-6 shadow-custom">
                        <div class="text-gray-500 text-sm mb-2">Penjualan Hari Ini</div>
                        <div class="text-4xl font-bold text-primary-blue">Rp2.500.000</div>
                    </div>
                    <div class="card p-6 shadow-custom">
                        <div class="text-gray-500 text-sm mb-2">Jumlah Transaksi</div>
                        <div class="text-4xl font-bold text-primary-blue">35</div>
                    </div>
                    <div class="card p-6 shadow-custom">
                        <div class="text-gray-500 text-sm mb-2">Stok Hampir Habis</div>
                        <div class="text-4xl font-bold text-accent-coffee">5</div>
                    </div>
                    <div class="card p-6 shadow-custom">
                        <div class="text-gray-500 text-sm mb-2">Shift Aktif</div>
                        <div class="text-4xl font-bold text-primary-blue">2</div>
                    </div>
                </div>
                <div class="card shadow-custom">
                    <h3 class="text-xl font-semibold mb-4 text-gray-900">Tren Penjualan Mingguan</h3>
                    <!-- Dummy Chart -->
                    <div class="w-full h-64 bg-gray-200 rounded-lg flex items-center justify-center text-gray-400">
                        
                    </div>
                </div>
            </div>

            <!-- Halaman Kasir -->
            <div id="page-kasir" class="page-content hidden">
                <h2 class="text-3xl font-bold mb-6 text-gray-900">Kasir</h2>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Product Grid -->
                    <div class="lg:col-span-2 card shadow-custom">
                        <h3 class="text-xl font-semibold mb-4 text-gray-900">Daftar Produk</h3>
                        <div id="product-list" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                            <!-- Products will be dynamically added here -->
                        </div>
                    </div>

                    <!-- Cart -->
                    <div class="lg:col-span-1 card shadow-custom">
                        <h3 class="text-xl font-semibold mb-4 text-gray-900">Keranjang Belanja</h3>
                        <div id="cart-items" class="mb-4">
                            <!-- Cart items will be dynamically added here -->
                        </div>
                        <div class="border-t pt-4">
                            <div class="flex justify-between items-center mb-4">
                                <span class="text-lg font-semibold text-gray-700">Total:</span>
                                <span id="cart-total" class="text-2xl font-bold text-primary-blue">Rp 0</span>
                            </div>
                            <button id="checkout-btn" class="w-full bg-primary-blue text-white py-3 rounded-lg font-bold hover:bg-opacity-90 transition-colors shadow-md">Bayar</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Halaman Manajemen Stok -->
            <div id="page-stok" class="page-content hidden">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                    <h2 class="text-3xl font-bold text-gray-900">Manajemen Stok</h2>
                    <div class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-4 mt-4 md:mt-0">
                        <button id="add-product-btn" class="bg-primary-blue text-white py-2 px-4 rounded-lg font-bold hover:bg-opacity-90 transition-colors shadow-md">Tambah Produk Baru</button>
                        <button id="export-csv-btn" class="bg-accent-coffee text-white py-2 px-4 rounded-lg font-bold hover:bg-opacity-80 transition-colors shadow-md">Ekspor ke CSV</button>
                    </div>
                </div>

                <div class="card overflow-x-auto shadow-custom">
                    <table class="w-full text-left table-auto">
                        <thead>
                            <tr class="bg-gray-50 text-gray-600 uppercase text-sm leading-normal">
                                <th class="py-3 px-6 text-left">Nama Produk</th>
                                <th class="py-3 px-6 text-left">Stok</th>
                                <th class="py-3 px-6 text-left">Status</th>
                                <th class="py-3 px-6 text-center">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="stock-table-body" class="text-gray-600 text-sm font-light">
                            <!-- Stock data will be dynamically added here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Halaman Shift Karyawan -->
            <div id="page-karyawan" class="page-content hidden">
                <h2 class="text-3xl font-bold mb-6 text-gray-900">Shift Karyawan</h2>
                
                <!-- Shift Management Form -->
                <div class="card mb-6 shadow-custom">
                    <h3 class="text-xl font-semibold mb-4 text-gray-900">Mulai Shift Baru</h3>
                    <form id="shift-form" class="space-y-4">
                        <div>
                            <label for="employee-name-input" class="block text-sm font-medium text-gray-700">Nama Karyawan</label>
                            <input type="text" id="employee-name-input" required class="mt-1 block w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-primary-blue focus:border-primary-blue" placeholder="Nama Karyawan">
                        </div>
                        <div>
                            <label for="shift-type" class="block text-sm font-medium text-gray-700">Pilihan Shift</label>
                            <select id="shift-type" class="mt-1 block w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-primary-blue focus:border-primary-blue">
                                <option value="Pagi">Shift Pagi (08:00 - 16:00)</option>
                                <option value="Siang">Shift Siang (14:00 - 22:00)</option>
                                <option value="Malam">Shift Malam (22:00 - 06:00)</option>
                            </select>
                        </div>
                        <button type="submit" id="start-shift-btn" class="w-full bg-primary-blue text-white py-3 rounded-lg font-bold hover:bg-opacity-90 transition-colors shadow-md">Mulai Shift</button>
                    </form>
                </div>

                <div class="card overflow-x-auto shadow-custom">
                    <table class="w-full text-left table-auto">
                        <thead>
                            <tr class="bg-gray-50 text-gray-600 uppercase text-sm leading-normal">
                                <th class="py-3 px-6 text-left">Nama Karyawan</th>
                                <th class="py-3 px-6 text-left">Waktu Mulai</th>
                                <th class="py-3 px-6 text-left">Jenis Shift</th>
                                <th class="py-3 px-6 text-left">Waktu Selesai</th>
                                <th class="py-3 px-6 text-center">Status</th>
                                <th class="py-3 px-6 text-center">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="shift-table-body" class="text-gray-600 text-sm font-light">
                            <!-- Shift data will be dynamically added here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Halaman QRIS & GoPay -->
            <div id="page-qris-gopay" class="page-content hidden">
                <h2 class="text-3xl font-bold mb-6 text-gray-900">Integrasi QRIS & GoPay</h2>
                <div class="card mb-6 shadow-custom">
                    <p class="mb-4 text-gray-700">Untuk mengunggah data transaksi dari GoPay Merchant, silakan pilih file CSV.</p>
                    <input type="file" id="gopay-csv-upload" accept=".csv" class="mb-4 border p-2 rounded-lg focus:outline-none focus:ring-primary-blue">
                    <button id="upload-csv-btn" class="bg-primary-blue text-white py-2 px-4 rounded-lg font-bold hover:bg-opacity-90 transition-colors shadow-md">Unggah & Proses</button>
                    <div id="upload-status" class="mt-4 text-green-600 font-semibold hidden">File berhasil diunggah!</div>
                </div>
                <div class="card shadow-custom">
                    <h3 class="text-xl font-semibold mb-4 text-gray-900">Riwayat Transaksi GoPay</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left table-auto">
                            <thead>
                                <tr class="bg-gray-50 text-gray-600 uppercase text-sm leading-normal">
                                    <th class="py-3 px-6 text-left">Tanggal</th>
                                    <th class="py-3 px-6 text-left">ID Transaksi</th>
                                    <th class="py-3 px-6 text-left">Jumlah</th>
                                </tr>
                            </thead>
                            <tbody id="gopay-transactions-body" class="text-gray-600 text-sm font-light">
                                <!-- Transaction data will be added here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Modal Container (for alerts & stock form) -->
            <div id="modal-container" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 p-4">
                <div id="modal-content" class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full">
                    <!-- Modal content will be dynamically loaded here -->
                </div>
            </div>

        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const sidebar = document.getElementById('sidebar');
            const sidebarToggleMobile = document.getElementById('sidebar-toggle-mobile');
            const overlay = document.getElementById('overlay');
            const navLinks = document.querySelectorAll('.menu-item');
            const pageContents = document.querySelectorAll('.page-content');
            const pageTitle = document.getElementById('page-title');
            
            // Modal elements
            const modalContainer = document.getElementById('modal-container');
            const modalContent = document.getElementById('modal-content');

            // Data dummy
            let products = [
                { id: 'prod1', name: 'Kopi Americano', price: 25000, image: 'https://placehold.co/150x150/6f4e37/ffffff?text=Kopi', stock: 50 },
                { id: 'prod2', name: 'Kopi Latte', price: 30000, image: 'https://placehold.co/150x150/6f4e37/ffffff?text=Latte', stock: 45 },
                { id: 'prod3', name: 'Roti Bakar', price: 18000, image: 'https://placehold.co/150x150/6f4e37/ffffff?text=Roti', stock: 30 },
                { id: 'prod4', name: 'Kentang Goreng', price: 20000, image: 'https://placehold.co/150x150/6f4e37/ffffff?text=Kentang', stock: 75 },
                { id: 'prod5', name: 'Jus Jeruk', price: 15000, image: 'https://placehold.co/150x150/6f4e37/ffffff?text=Jus', stock: 60 },
            ];
            let shifts = [
                { id: 1, name: 'Budi', shiftType: 'Pagi', startTime: '2023-10-27T08:00:00', endTime: null, status: 'Aktif' },
                { id: 2, name: 'Siti', shiftType: 'Siang', startTime: '2023-10-27T14:00:00', endTime: null, status: 'Aktif' },
                { id: 3, name: 'Andi', shiftType: 'Pagi', startTime: '2023-10-26T09:00:00', endTime: '2023-10-26T17:00:00', status: 'Selesai' },
            ];
            let gopayTransactions = [];
            let cart = [];

            // --- Modal Functions ---
            const showModal = (contentHtml) => {
                modalContent.innerHTML = contentHtml;
                modalContainer.classList.remove('hidden');
            };

            const hideModal = () => {
                modalContainer.classList.add('hidden');
                modalContent.innerHTML = ''; // Clear content on hide
            };

            // Global event listener for modal close button
            modalContainer.addEventListener('click', (e) => {
                if (e.target.id === 'modal-close-btn') {
                    hideModal();
                }
            });

            // --- Sidebar and Page Navigation ---
            sidebarToggleMobile.addEventListener('click', () => {
                sidebar.classList.toggle('sidebar-hidden');
                overlay.classList.toggle('hidden');
            });
            overlay.addEventListener('click', () => {
                sidebar.classList.add('sidebar-hidden');
                overlay.classList.add('hidden');
            });

            const renderPage = (pageId) => {
                pageContents.forEach(page => {
                    page.classList.add('hidden');
                });
                document.getElementById(pageId).classList.remove('hidden');
                
                navLinks.forEach(link => {
                    link.classList.remove('active');
                });
                document.querySelector(`[data-page="${pageId.replace('page-', '')}"]`).classList.add('active');

                const pageName = document.querySelector(`[data-page="${pageId.replace('page-', '')}"] span`).textContent;
                pageTitle.textContent = pageName;

                if (window.innerWidth <= 768) {
                    sidebar.classList.add('sidebar-hidden');
                    overlay.classList.add('hidden');
                }
            };
            
            // --- Kasir Page ---
            const renderProducts = () => {
                const productList = document.getElementById('product-list');
                productList.innerHTML = '';
                products.forEach(product => {
                    const productCard = document.createElement('div');
                    productCard.className = `p-4 bg-gray-50 rounded-lg shadow-sm border border-gray-200 cursor-pointer ${product.stock === 0 ? 'opacity-50' : ''}`;
                    productCard.innerHTML = `
                        <img src="${product.image}" alt="${product.name}" class="w-full h-24 object-cover rounded-md mb-2">
                        <h4 class="font-bold text-sm truncate">${product.name}</h4>
                        <p class="text-xs text-gray-500 mb-1">Stok: ${product.stock}</p>
                        <p class="text-sm font-semibold text-primary-blue">Rp ${product.price.toLocaleString('id-ID')}</p>
                    `;
                    if (product.stock > 0) {
                         productCard.addEventListener('click', () => addToCart(product));
                    }
                    productList.appendChild(productCard);
                });
            };

            const addToCart = (product) => {
                const existingItem = cart.find(item => item.id === product.id);
                if (existingItem) {
                    existingItem.quantity++;
                } else {
                    cart.push({ ...product, quantity: 1 });
                }
                renderCart();
            };

            const renderCart = () => {
                const cartItemsContainer = document.getElementById('cart-items');
                cartItemsContainer.innerHTML = '';
                let total = 0;

                if (cart.length === 0) {
                    cartItemsContainer.innerHTML = '<p class="text-center text-gray-400">Keranjang kosong.</p>';
                } else {
                    cart.forEach(item => {
                        const cartItemEl = document.createElement('div');
                        cartItemEl.className = 'flex justify-between items-center py-2 border-b';
                        cartItemEl.innerHTML = `
                            <div>
                                <h4 class="font-semibold text-sm">${item.name}</h4>
                                <p class="text-xs text-gray-500">${item.quantity} x Rp ${item.price.toLocaleString('id-ID')}</p>
                            </div>
                            <span class="font-bold text-sm text-primary-blue">Rp ${(item.price * item.quantity).toLocaleString('id-ID')}</span>
                        `;
                        cartItemsContainer.appendChild(cartItemEl);
                        total += item.price * item.quantity;
                    });
                }
                document.getElementById('cart-total').textContent = `Rp ${total.toLocaleString('id-ID')}`;
            };
            
            // Checkout button handler
            document.getElementById('checkout-btn').addEventListener('click', () => {
                if (cart.length === 0) {
                    showModal(`
                        <h3 class="text-xl font-bold mb-4 text-gray-900">Keranjang Kosong</h3>
                        <p class="mb-4 text-gray-700">Silakan tambahkan produk ke keranjang terlebih dahulu.</p>
                        <div class="flex justify-end">
                            <button id="modal-close-btn" class="bg-primary-blue text-white py-2 px-4 rounded-lg font-bold hover:bg-opacity-90 transition-colors shadow-md">Tutup</button>
                        </div>
                    `);
                    return;
                }
                
                let transactionSuccess = true;
                cart.forEach(item => {
                    const productIndex = products.findIndex(p => p.id === item.id);
                    if (productIndex !== -1) {
                        if (products[productIndex].stock >= item.quantity) {
                            products[productIndex].stock -= item.quantity;
                        } else {
                            transactionSuccess = false;
                            showModal(`
                                <h3 class="text-xl font-bold mb-4 text-gray-900">Stok Tidak Cukup</h3>
                                <p class="mb-4 text-gray-700">Stok ${products[productIndex].name} tidak mencukupi.</p>
                                <div class="flex justify-end">
                                    <button id="modal-close-btn" class="bg-primary-blue text-white py-2 px-4 rounded-lg font-bold hover:bg-opacity-90 transition-colors shadow-md">Tutup</button>
                                </div>
                            `);
                        }
                    }
                });
                
                if (transactionSuccess) {
                    cart = [];
                    renderCart();
                    renderStock();
                    renderProducts();
                    showModal(`
                        <h3 class="text-xl font-bold mb-4 text-gray-900">Transaksi Berhasil</h3>
                        <p class="mb-4 text-gray-700">Pembayaran sukses dan stok telah diperbarui.</p>
                        <div class="flex justify-end">
                            <button id="modal-close-btn" class="bg-primary-blue text-white py-2 px-4 rounded-lg font-bold hover:bg-opacity-90 transition-colors shadow-md">Tutup</button>
                        </div>
                    `);
                }
            });

            // --- Stock Page ---
            const showStockFormModal = (product = null) => {
                const formTitle = product ? 'Perbarui Produk' : 'Tambah Produk Baru';
                const buttonText = product ? 'Simpan Perubahan' : 'Tambah Produk';
                
                showModal(`
                    <h3 class="text-xl font-semibold mb-4 text-gray-900">${formTitle}</h3>
                    <form id="stock-form" class="space-y-4">
                        <input type="hidden" id="product-id" value="${product ? product.id : ''}">
                        <div>
                            <label for="product-name" class="block text-sm font-medium text-gray-700">Nama Produk</label>
                            <input type="text" id="product-name" required class="mt-1 block w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-primary-blue focus:border-primary-blue" value="${product ? product.name : ''}">
                        </div>
                        <div>
                            <label for="product-price" class="block text-sm font-medium text-gray-700">Harga</label>
                            <input type="number" id="product-price" required class="mt-1 block w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-primary-blue focus:border-primary-blue" value="${product ? product.price : ''}">
                        </div>
                        <div>
                            <label for="product-stock" class="block text-sm font-medium text-gray-700">Stok</label>
                            <input type="number" id="product-stock" required class="mt-1 block w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-primary-blue focus:border-primary-blue" value="${product ? product.stock : ''}">
                        </div>
                        <div class="flex space-x-2">
                            <button type="submit" id="submit-stock-btn" class="flex-1 bg-primary-blue text-white py-3 rounded-lg font-bold hover:bg-opacity-90 transition-colors shadow-md">${buttonText}</button>
                            <button type="button" id="modal-close-btn" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-400 transition-colors shadow-md">Batal</button>
                        </div>
                    </form>
                `);

                // Add event listener to the newly created form
                document.getElementById('stock-form').addEventListener('submit', handleStockFormSubmit);
            };

            const handleStockFormSubmit = (e) => {
                e.preventDefault();
                const productId = document.getElementById('product-id').value;
                const productName = document.getElementById('product-name').value;
                const productPrice = parseInt(document.getElementById('product-price').value, 10);
                const productStock = parseInt(document.getElementById('product-stock').value, 10);

                if (productId) {
                    const productIndex = products.findIndex(p => p.id === productId);
                    if (productIndex > -1) {
                        products[productIndex].name = productName;
                        products[productIndex].price = productPrice;
                        products[productIndex].stock = productStock;
                        showModal(`
                            <h3 class="text-xl font-bold mb-4 text-gray-900">Produk Diperbarui</h3>
                            <p class="mb-4 text-gray-700">Produk ${productName} berhasil diperbarui.</p>
                            <div class="flex justify-end">
                                <button id="modal-close-btn" class="bg-primary-blue text-white py-2 px-4 rounded-lg font-bold hover:bg-opacity-90 transition-colors shadow-md">Tutup</button>
                            </div>
                        `);
                    }
                } else {
                    const newId = `prod${products.length + 1}`;
                    const newProduct = {
                        id: newId,
                        name: productName,
                        price: productPrice,
                        stock: productStock,
                        image: `https://placehold.co/150x150/6f4e37/ffffff?text=${productName.split(' ')[0]}`
                    };
                    products.push(newProduct);
                    showModal(`
                        <h3 class="text-xl font-bold mb-4 text-gray-900">Produk Ditambahkan</h3>
                        <p class="mb-4 text-gray-700">${productName} berhasil ditambahkan.</p>
                        <div class="flex justify-end">
                            <button id="modal-close-btn" class="bg-primary-blue text-white py-2 px-4 rounded-lg font-bold hover:bg-opacity-90 transition-colors shadow-md">Tutup</button>
                        </div>
                    `);
                }
                
                renderStock();
                renderProducts();
            };

            const renderStock = () => {
                const stockTableBody = document.getElementById('stock-table-body');
                stockTableBody.innerHTML = '';
                products.forEach((product, index) => {
                    const row = document.createElement('tr');
                    const statusClass = product.stock > 10 ? 'text-green-500' : (product.stock > 0 ? 'text-yellow-500' : 'text-red-500');
                    const statusText = product.stock > 10 ? 'Aman' : (product.stock > 0 ? 'Hampir Habis' : 'Habis');
                    row.className = `border-b border-gray-200 transition-colors duration-200 ${index % 2 === 0 ? 'bg-white' : 'bg-gray-50'} hover:bg-gray-100`;
                    row.innerHTML = `
                        <td class="py-3 px-6">${product.name}</td>
                        <td class="py-3 px-6">${product.stock}</td>
                        <td class="py-3 px-6">
                            <span class="font-bold ${statusClass}">${statusText}</span>
                        </td>
                        <td class="py-3 px-6 text-center">
                            <div class="flex items-center justify-center space-x-2">
                                <button onclick="window.editProduct('${product.id}')" class="text-sm text-primary-blue hover:text-primary-blue/80 font-bold">Edit</button>
                                <button onclick="window.deleteProduct('${product.id}')" class="text-sm text-red-500 hover:text-red-600 font-bold">Hapus</button>
                            </div>
                        </td>
                    `;
                    stockTableBody.appendChild(row);
                });
            };

            window.editProduct = (productId) => {
                const product = products.find(p => p.id === productId);
                if (product) {
                    showStockFormModal(product);
                }
            };
            
            window.deleteProduct = (productId) => {
                const productIndex = products.findIndex(p => p.id === productId);
                if (productIndex > -1) {
                    products.splice(productIndex, 1);
                    renderStock();
                    renderProducts();
                    showModal(`
                        <h3 class="text-xl font-bold mb-4 text-gray-900">Produk Dihapus</h3>
                        <p class="mb-4 text-gray-700">Produk telah dihapus.</p>
                        <div class="flex justify-end">
                            <button id="modal-close-btn" class="bg-primary-blue text-white py-2 px-4 rounded-lg font-bold hover:bg-opacity-90 transition-colors shadow-md">Tutup</button>
                        </div>
                    `);
                }
            };
            
            document.getElementById('add-product-btn').addEventListener('click', () => {
                showStockFormModal();
            });
            
            document.getElementById('export-csv-btn').addEventListener('click', () => {
                let csvContent = "data:text/csv;charset=utf-8,";
                csvContent += "Nama Produk,Stok,Status\n";
                products.forEach(product => {
                    const status = product.stock > 10 ? 'Aman' : (product.stock > 0 ? 'Hampir Habis' : 'Habis');
                    csvContent += `${product.name},${product.stock},${status}\n`;
                });
                
                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", "data_stok.csv");
                document.body.appendChild(link);
                link.click();
                link.remove();
            });

            // --- Shift Karyawan Page ---
            const renderShifts = () => {
                const shiftTableBody = document.getElementById('shift-table-body');
                shiftTableBody.innerHTML = '';
                shifts.forEach((shift, index) => {
                    const row = document.createElement('tr');
                    const statusColor = shift.status === 'Aktif' ? 'bg-green-200 text-green-800' : 'bg-gray-200 text-gray-800';
                    const endTimeDisplay = shift.endTime ? new Date(shift.endTime).toLocaleString() : '---';

                    row.className = `border-b border-gray-200 transition-colors duration-200 ${index % 2 === 0 ? 'bg-white' : 'bg-gray-50'} hover:bg-gray-100`;
                    row.innerHTML = `
                        <td class="py-4 px-6">${shift.name}</td>
                        <td class="py-4 px-6">${new Date(shift.startTime).toLocaleString()}</td>
                        <td class="py-4 px-6">${shift.shiftType}</td>
                        <td class="py-4 px-6">${endTimeDisplay}</td>
                        <td class="py-4 px-6 text-center">
                            <span class="py-1 px-3 rounded-full text-xs font-semibold ${statusColor}">${shift.status}</span>
                        </td>
                        <td class="py-4 px-6 text-center">
                            <div class="flex items-center justify-center space-x-2">
                                ${shift.status === 'Aktif' ? 
                                    `<button onclick="window.endShift(${shift.id})" class="bg-red-500 text-white px-3 py-1 rounded-lg text-xs font-bold hover:bg-red-600 shadow-sm">Akhiri Shift</button>` : 
                                    `<button onclick="window.deleteShift(${shift.id})" class="bg-gray-500 text-white px-3 py-1 rounded-lg text-xs font-bold hover:bg-gray-600 shadow-sm">Hapus</button>`}
                            </div>
                        </td>
                    `;
                    shiftTableBody.appendChild(row);
                });
            };
            
            window.endShift = (shiftId) => {
                const shiftIndex = shifts.findIndex(s => s.id === shiftId);
                if (shiftIndex !== -1) {
                    shifts[shiftIndex].status = 'Selesai';
                    shifts[shiftIndex].endTime = new Date().toISOString();
                    renderShifts();
                    showModal(`
                        <h3 class="text-xl font-bold mb-4 text-gray-900">Shift Selesai</h3>
                        <p class="mb-4 text-gray-700">Shift untuk ${shifts[shiftIndex].name} telah selesai.</p>
                        <div class="flex justify-end">
                            <button id="modal-close-btn" class="bg-primary-blue text-white py-2 px-4 rounded-lg font-bold hover:bg-opacity-90 transition-colors shadow-md">Tutup</button>
                        </div>
                    `);
                }
            };
            
            window.deleteShift = (shiftId) => {
                const shiftIndex = shifts.findIndex(s => s.id === shiftId);
                if (shiftIndex !== -1) {
                    shifts.splice(shiftIndex, 1);
                    renderShifts();
                    showModal(`
                        <h3 class="text-xl font-bold mb-4 text-gray-900">Shift Dihapus</h3>
                        <p class="mb-4 text-gray-700">Data shift telah dihapus.</p>
                        <div class="flex justify-end">
                            <button id="modal-close-btn" class="bg-primary-blue text-white py-2 px-4 rounded-lg font-bold hover:bg-opacity-90 transition-colors shadow-md">Tutup</button>
                        </div>
                    `);
                }
            };

            document.getElementById('shift-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const employeeNameInput = document.getElementById('employee-name-input');
                const employeeName = employeeNameInput.value.trim();
                const shiftType = document.getElementById('shift-type').value;

                if (employeeName) {
                    const newShift = {
                        id: shifts.length + 1,
                        name: employeeName,
                        shiftType: shiftType,
                        startTime: new Date().toISOString(),
                        endTime: null,
                        status: 'Aktif'
                    };
                    shifts.push(newShift);
                    renderShifts();
                    document.getElementById('shift-form').reset();
                    showModal(`
                        <h3 class="text-xl font-bold mb-4 text-gray-900">Shift Dimulai</h3>
                        <p class="mb-4 text-gray-700">Shift ${shiftType} untuk ${employeeName} telah dimulai.</p>
                        <div class="flex justify-end">
                            <button id="modal-close-btn" class="bg-primary-blue text-white py-2 px-4 rounded-lg font-bold hover:bg-opacity-90 transition-colors shadow-md">Tutup</button>
                        </div>
                    `);
                } else {
                    showModal(`
                        <h3 class="text-xl font-bold mb-4 text-gray-900">Peringatan</h3>
                        <p class="mb-4 text-gray-700">Nama karyawan tidak boleh kosong.</p>
                        <div class="flex justify-end">
                            <button id="modal-close-btn" class="bg-primary-blue text-white py-2 px-4 rounded-lg font-bold hover:bg-opacity-90 transition-colors shadow-md">Tutup</button>
                        </div>
                    `);
                }
            });


            // --- QRIS & GoPay Page ---
            const renderGoPayTransactions = () => {
                const gopayTransactionsBody = document.getElementById('gopay-transactions-body');
                gopayTransactionsBody.innerHTML = '';
                if (gopayTransactions.length === 0) {
                     gopayTransactionsBody.innerHTML = '<tr class="border-b border-gray-200"><td colspan="3" class="py-3 px-6 text-center text-gray-400">Belum ada data transaksi.</td></tr>';
                } else {
                    gopayTransactions.forEach((transaction, index) => {
                        const row = document.createElement('tr');
                        row.className = `border-b border-gray-200 transition-colors duration-200 ${index % 2 === 0 ? 'bg-white' : 'bg-gray-50'} hover:bg-gray-100`;
                        row.innerHTML = `
                            <td class="py-3 px-6">${transaction.date}</td>
                            <td class="py-3 px-6">${transaction.id}</td>
                            <td class="py-3 px-6">Rp ${transaction.amount.toLocaleString('id-ID')}</td>
                        `;
                        gopayTransactionsBody.appendChild(row);
                    });
                }
            };

            document.getElementById('upload-csv-btn').addEventListener('click', () => {
                const fileInput = document.getElementById('gopay-csv-upload');
                const file = fileInput.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const csvData = event.target.result;
                        processCSV(csvData);
                        document.getElementById('upload-status').classList.remove('hidden');
                        showModal(`
                            <h3 class="text-xl font-bold mb-4 text-gray-900">Unggah Sukses</h3>
                            <p class="mb-4 text-gray-700">Data transaksi GoPay berhasil diimpor.</p>
                            <div class="flex justify-end">
                                <button id="modal-close-btn" class="bg-primary-blue text-white py-2 px-4 rounded-lg font-bold hover:bg-opacity-90 transition-colors shadow-md">Tutup</button>
                            </div>
                        `);
                    };
                    reader.readAsText(file);
                } else {
                    showModal(`
                        <h3 class="text-xl font-bold mb-4 text-gray-900">Peringatan</h3>
                        <p class="mb-4 text-gray-700">Silakan pilih file CSV terlebih dahulu.</p>
                        <div class="flex justify-end">
                            <button id="modal-close-btn" class="bg-primary-blue text-white py-2 px-4 rounded-lg font-bold hover:bg-opacity-90 transition-colors shadow-md">Tutup</button>
                        </div>
                    `);
                }
            });

            const processCSV = (csv) => {
                const lines = csv.split('\n');
                const headers = lines[0].split(',').map(h => h.trim());
                gopayTransactions = [];
                for (let i = 1; i < lines.length; i++) {
                    const values = lines[i].split(',').map(v => v.trim());
                    if (values.length === headers.length) {
                        const transaction = {
                            date: values[headers.indexOf('Tanggal')],
                            id: values[headers.indexOf('ID Transaksi')],
                            amount: parseInt(values[headers.indexOf('Jumlah')].replace(/\./g, '').replace('Rp ', ''), 10),
                        };
                        gopayTransactions.push(transaction);
                    }
                }
                renderGoPayTransactions();
            };


            // Initial page render and event listeners
            renderPage('page-dashboard');
            renderProducts();
            renderCart();
            renderStock();
            renderShifts();
            renderGoPayTransactions();
            
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const pageId = `page-${link.dataset.page}`;
                    renderPage(pageId);
                });
            });

        });
    </script>

</body>
</html>
